---
# Playbook principal - Ejecuta todo el flujo de deployment
- name: Complete GKE AutoScaling Deployment Pipeline
  hosts: localhost
  gather_facts: true

  tasks:
    - name: Step 1 - Setup GKE Cluster
      ansible.builtin.include_tasks: tasks/setup-gke-cluster.yml
      tags: [cluster, setup]

    - name: Step 2 - Build and Push Docker Images
      ansible.builtin.include_tasks: tasks/build-and-push-images.yml
      tags: [build, images]

    - name: Step 3 - Deploy Application
      ansible.builtin.include_tasks: tasks/deploy-app.yml
      tags: [deploy, app]

    - name: Display final summary
      ansible.builtin.debug:
        msg:
          - "=========================================="
          - "  TodoApp Deployment Complete!"
          - "=========================================="
          - ""
          - "Cluster: {{ gke_cluster_name }}"
          - "Region: {{ gcp_region }}"
          - "Zone: {{ gcp_zone }}"
          - ""
          - "Auto-scaling Configuration:"
          - "  - Cluster Nodes: {{ gke_node_pool.min_node_count }}-{{ gke_node_pool.max_node_count }}"
          - "  - Backend Pods: {{ autoscaling.backend.min_replicas }}-{{ autoscaling.backend.max_replicas }}"
          - "  - Frontend Pods: {{ autoscaling.frontend.min_replicas }}-{{ autoscaling.frontend.max_replicas }}"
          - ""
          - "Next Steps:"
          - "  1. Run load tests: cd ../load-testing && ./run-load-test.sh"
          - "  2. Monitor HPA: kubectl get hpa -n {{ app_namespace }} -w"
          - "  3. Monitor nodes: kubectl get nodes -w"
          - "=========================================="
